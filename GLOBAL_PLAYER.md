# 全局播放器使用说明

## ✅ 已完成的功能

### 1. **全局音频播放器**
- ✅ 固定在所有页面底部的播放控制条
- ✅ 跨页面持续播放（页面跳转不中断）
- ✅ 播放状态自动保存到 localStorage
- ✅ 页面刷新后自动恢复播放状态

### 2. **播放控制**
- ✅ 播放/暂停按钮
- ✅ 上一章/下一章快速切换
- ✅ 进度条点击跳转
- ✅ 实时显示播放时间
- ✅ 关闭播放器按钮

### 3. **移动端优化**
- ✅ 响应式设计，适配手机和平板
- ✅ iOS 安全区域适配（刘海屏支持）
- ✅ Media Session API 集成（锁屏控制）
- ✅ 触摸优化，防止误操作

### 4. **自动功能**
- ✅ 章节播放完毕自动播放下一章
- ✅ 网络中断自动重连
- ✅ 加载状态提示

## 📱 使用方法

### **在阅读页点击"有声书"**
1. 进入任意小说的阅读页面
2. 点击顶部的"🎵 有声书"链接
3. 全局播放器从底部弹出并开始播放
4. 现在可以自由跳转到目录、其他章节，播放不会中断！

### **播放器控制**
- **⏮ 上一章**：播放上一章节
- **▶/⏸ 播放/暂停**：控制播放状态
- **⏭ 下一章**：播放下一章节
- **✖ 关闭**：关闭播放器并清除状态
- **进度条**：点击任意位置跳转播放进度

### **移动端后台播放**
- iOS：锁屏后在锁屏界面控制播放
- Android：通知栏显示媒体控制
- 支持蓝牙耳机控制

## 🔧 技术实现

### **核心架构**
```
base.html (基础模板)
    ↓
包含全局播放器 HTML/CSS
    ↓
加载 global-player.js
    ↓
所有页面继承 base.html
```

### **状态管理**
使用 `localStorage` 保存播放状态：
- 当前小说 ID 和标题
- 当前章节 ID 和标题
- 播放位置（currentTime）
- 章节列表（用于上下章切换）

### **关键文件**
- `templates/base.html` - 基础模板
- `static/js/global-player.js` - 播放器逻辑
- `templates/reader.html` - 阅读页（已集成）
- `templates/toc.html` - 目录页（已集成）
- `templates/novels.html` - 小说列表（已集成）
- `templates/index.html` - 首页（已集成）

## ⚠️ 注意事项

1. **自动播放限制**
   - 首次播放需要用户点击交互
   - 页面刷新后可能需要手动播放

2. **网络要求**
   - 流式播放需要稳定网络
   - 弱网环境可能出现缓冲

3. **浏览器兼容性**
   - 推荐使用 Chrome、Safari、Edge 最新版
   - Media Session API 需要较新版本浏览器

## 🚀 未来优化方向

1. **Service Worker 离线缓存**
   - 实现章节预缓存
   - 支持离线播放

2. **播放列表管理**
   - 添加播放队列
   - 支持自定义播放顺序

3. **更多控制选项**
   - 倍速播放（0.5x - 2.0x）
   - 定时关闭
   - 睡眠模式

4. **增强的 Media Session**
   - 显示封面图片
   - 更详细的元数据
